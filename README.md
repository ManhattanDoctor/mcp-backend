# MCP Backend - Сервер таможенных кодов ТН ВЭД

## Описание

Этот проект представляет собой MCP (Model Context Protocol) сервер, который предоставляет доступ к полной базе данных таможенных кодов ТН ВЭД (Товарная номенклатура внешнеэкономической деятельности). Сервер использует гибридный поиск, сочетающий текстовый поиск с векторным поиском для максимально точных результатов.

## Что такое ТН ВЭД?

ТН ВЭД - это система классификации товаров, используемая для таможенного оформления и статистики внешней торговли. Каждый товар имеет уникальный код, который определяет его категорию, ставки пошлин и другие таможенные характеристики.

## Возможности

- **Гибридный поиск**: Комбинация текстового поиска (MiniSearch) и векторного поиска (Gnosis AI)
- **Полная база данных**: Более 13,000 таможенных кодов с детальными описаниями
- **Нечеткий поиск**: Поиск работает даже с неточными или частичными запросами
- **Высокая точность**: Векторный поиск обеспечивает семантическое понимание запросов
- **MCP интеграция**: Легкая интеграция с AI-ассистентами и другими приложениями
- **Docker поддержка**: Готовые контейнеры для развертывания

## Установка и запуск

### Требования

- Node.js (версия 20 или выше)
- npm или yarn
- Docker (опционально)

### Локальная установка

1. Установка зависимостей:
```bash
npm install
```

2. Переход в директорию приложения:
```bash
cd src/packages/application/tnved-code
```

3. Установка зависимостей приложения:
```bash
npm install
```

4. Запуск сервера:
```bash
npm start
```

### Docker запуск

```bash
# Сборка образа
docker build -f docker/tnved-code/Dockerfile -t mcp-tnved-code .

# Запуск контейнера
docker run -p 3001:3001 mcp-tnved-code
```

Сервер будет запущен на порту 3001 (по умолчанию).

## Использование

### Доступные инструменты

1. **customs_codes_search** - поиск таможенных кодов
   - Параметр: `query` (строка) - запрос для поиска
   - Параметр: `maximum` (число, опционально) - максимальное количество результатов (по умолчанию: 50)
   - Возвращает: список найденных кодов с оценкой релевантности

2. **customs_code_get** - получение конкретного кода
   - Параметр: `code` (строка) - код для получения
   - Возвращает: детальную информацию о коде

### Примеры использования

#### Поиск кодов по описанию
```
Запрос: "автомобили легковые"
Результат: список кодов, связанных с легковыми автомобилями с оценками релевантности
```

#### Получение конкретного кода
```
Запрос: код "8703"
Результат: детальное описание кода 8703
```

## Технические детали

- **Фреймворк**: NestJS с TypeScript
- **Поиск**: 
  - MiniSearch для быстрого текстового поиска с нечетким соответствием
  - Gnosis AI API для векторного семантического поиска
- **Протокол**: MCP (Model Context Protocol) v1.0.0
- **База данных**: Встроенная база данных с 13,000+ кодов ТН ВЭД
- **Контейнеризация**: Docker с Node.js 20
- **Валидация**: Zod схемы для типизации данных

## Архитектура

### Компоненты

- **AppModule**: Основной модуль NestJS с конфигурацией MCP
- **CodeTool**: MCP инструменты для поиска и получения кодов
- **Codes**: Сервис для работы с данными и гибридного поиска
- **InitializeService**: Сервис инициализации приложения
- **Data**: Встроенная база данных кодов ТН ВЭД

### Гибридный поиск

1. **Текстовый поиск**: MiniSearch с нечетким соответствием (fuzzy: 0.2)
2. **Векторный поиск**: Gnosis AI API для семантического поиска
3. **Объединение результатов**: Дедупликация и ранжирование по релевантности

## Структура проекта

```
mcp-backend/
├── src/
│   └── packages/
│       ├── application/
│       │   └── tnved-code/          # Основное приложение
│       │       ├── src/
│       │       │   ├── service/     # Сервисы (Codes, InitializeService)
│       │       │   ├── tool/        # MCP инструменты (CodeTool)
│       │       │   ├── Data.ts      # База данных кодов (13,000+ записей)
│       │       │   ├── AppModule.ts # Основной модуль
│       │       │   └── AppSettings.ts # Настройки приложения
│       │       ├── main.ts          # Точка входа
│       │       └── package.json     # Зависимости приложения
│       └── module/                   # Общие модули
│           └── core/                 # Базовые классы
├── docker/
│   └── tnved-code/
│       └── Dockerfile               # Docker конфигурация
├── .github/workflows/              # CI/CD пайплайны
└── package.json                    # Корневые зависимости
```

## Настройка

### Переменные окружения

- `WEB_PORT` - порт сервера (по умолчанию: 3001)
- `WEB_HOST` - хост сервера (по умолчанию: localhost)

### Конфигурация поиска

- **Текстовый поиск**: Настроен с boost для кодов (коэффициент 2) и нечетким соответствием 0.2
- **Векторный поиск**: Использует Gnosis AI API с минимальным порогом релевантности 0.3

## CI/CD

Проект включает GitHub Actions для:
- Автоматической сборки Docker образов
- Развертывания в контейнерной среде
- Тестирования и валидации кода

## Лицензия

MIT License

## Автор

Renat Gubaev

## Поддержка

Если у вас есть вопросы или проблемы, создайте issue в репозитории проекта.